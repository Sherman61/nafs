version: '3.9'

services:
  medusa:
    build:
      context: ./server
    environment:
      - PORT=9000
      - DATABASE_URL=postgres://medusa:medusa@postgres:5432/medusa
      - REDIS_URL=redis://redis:6379
      - STORE_CORS=http://localhost:5173
      - ADMIN_CORS=http://localhost:7001
      - STRIPE_API_KEY=${STRIPE_API_KEY:-}
      - STRIPE_WEBHOOK_SECRET=${STRIPE_WEBHOOK_SECRET:-}
      - PAYPAL_CLIENT_ID=${PAYPAL_CLIENT_ID:-}
      - PAYPAL_CLIENT_SECRET=${PAYPAL_CLIENT_SECRET:-}
    ports:
      - '9000:9000'
    depends_on:
      - postgres
      - redis

  postgres:
    image: postgres:15-alpine
    restart: unless-stopped
    environment:
      - POSTGRES_DB=medusa
      - POSTGRES_USER=medusa
      - POSTGRES_PASSWORD=medusa
    volumes:
      - postgres-data:/var/lib/postgresql/data
    ports:
      - '5432:5432'

  redis:
    image: redis:7-alpine
    restart: unless-stopped
    command: redis-server --save 60 1 --loglevel warning
    volumes:
      - redis-data:/data
    ports:
      - '6379:6379'

  client:
    build:
      context: ./client
    environment:
      - VITE_API_BASE_URL=http://localhost:9000
    ports:
      - '5173:5173'
    depends_on:
      - medusa

volumes:
  postgres-data:
  redis-data:
